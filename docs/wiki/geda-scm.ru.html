<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
  <link rel="stylesheet" media="screen" type="text/css" href="./style.css" />
  <link rel="stylesheet" media="screen" type="text/css" href="./design.css" />
  <link rel="stylesheet" media="print" type="text/css" href="./print.css" />

  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
</head>
<body>

<p>
<em>Эта страница доступна также на следующих языках:</em> <a href="geda-scm.html" class="wikilink1" title="geda-scm.html">English</a>
</p>

<h1 id="gedagafиgit">gEDA/gaf и git</h1>
<div class="level1">

<p>
В gEDA для управления исходными текстами программ используется <strong>git</strong>.
<strong>git</strong> --- это распределённая система управления версиями, которая
позволяет каждому пользователю иметь свою собственную полную копию истории
изменений проекта.
</p>
<ul>
<li class="level1"><div class="li"> Официальная веб-страница git</div>
</li>
<li class="level1"><div class="li"> Интерактивная документация по git</div>
</li>
<li class="level1"><div class="li"> <a href="https://www.google.com/search?q=Git_%28software%29&amp;btnI=lucky" class="interwiki iw_go" title="https://www.google.com/search?q=Git_%28software%29&amp;btnI=lucky">Страница википедии по git</a></div>
</li>
</ul>

</div>

<h2 id="установкаgitидругихвспомогательныхпрограмм">Установка git и других вспомогательных программ</h2>
<div class="level2">

<p>
Конечно, в первую очередь для использования репозитория необходимы основные
инструменты <strong>git</strong>, и всегда полезна документация. Но часто для работы с
<strong>git</strong> удобно пользоваться и другими средствами:
</p>
<ul>
<li class="level1"><div class="li"> gitk, программа просмотра истории репозитория</div>
</li>
<li class="level1"><div class="li"> Stacked Git, для работы с наборами заплат</div>
</li>
</ul>

<p>
Для дистрибутивов на основе Debian:
</p>
<pre class="code">apt-get install git-core git-doc gitk stgit</pre>

<p>
Ещё может пригодиться следующее:
</p>
<pre class="code">apt-get install git-email git-completion</pre>

<p>
Fedora Linux:
</p>
<pre class="code">yum install git stgit</pre>

</div>

<h2 id="изучениеgit">Изучение git</h2>
<div class="level2">

<p>
Главная страница документации <strong>git</strong>:
</p>
<ul>
<li class="level1"><div class="li"> Официальная документация git</div>
</li>
</ul>

<p>
Руководство пользователя <strong>git</strong>:
</p>
<ul>
<li class="level1"><div class="li"> Руководство пользователя git</div>
</li>
</ul>

<p>
Текущее руководство можно найти по ссылке:
</p>
<ul>
<li class="level1"><div class="li"> Введение в основы git</div>
</li>
</ul>

<p>
Другие замечательные руководства/веб-страницы:
</p>
<ul>
<li class="level1"><div class="li"> Руководство по Git</div>
</li>
<li class="level1"><div class="li"> Аварийные курсы по git</div>
</li>
</ul>

<p>
Имейте в виду, что некоторые из этих руководств немного устарели и могут не
совсем полно отражать текущий синтаксис <strong>git</strong>.
</p>

</div>

<h2 id="анонимныйдоступкрепозиторию">Анонимный доступ к репозиторию</h2>
<div class="level2">

<p>
Клонирование (создание точной локальной копии) репозитория <strong>geda-gaf.git</strong>
(или любого другого репозитория, поддерживаемого на
git.geda-project.org) с использованием
анонимного доступа <strong>git</strong> производится так:
</p>
<pre class="code">git clone git://git.geda-project.org/geda-gaf.git</pre>

<p>
или
</p>
<pre class="code">git clone git://git.geda-project.org/pcb.git</pre>

<p>
Для клонирования других репозиториев, поддерживаемых на
<code>git.geda-project.org</code>, достаточно поправить последнюю часть вышеуказанной
ссылки.
</p>

<p>
Для репозиториев различных проектов существует
cgit-интерфейс. Открыть его можно,
просто набрав в строке адреса браузера http://git.geda-project.org/.
</p>

</div>

<h2 id="доступкрепозиториюсправаминазапись">Доступ к репозиторию с правами на запись</h2>
<div class="level2">

<p>
Для доступа в <strong>git</strong> с правами разработчика вам нужно связаться с <em>DJ
Delorie</em>, чтобы он установил ваш открытый ключ SSH на сервере, после этого
для отправки своих изменений можно использовать следующие адреса:
</p>
<pre class="code">ssh://git@git.geda-project.org/geda-gaf.git</pre>

<p>
или
</p>
<pre class="code">ssh://git@git.geda-project.org/pcb.git</pre>

<p>
Вам также будет нужно отредактировать у себя файл <em><code>~/.ssh/config</code></em>
(создать, если он ещё не существует) и вставить туда следующий текст:
</p>
<pre class="code">Host git.geda-project.org
Port 65</pre>

<p>
Примечание: если у вас проблемы с отправкой изменений в основной репозиторий
проекта, убедитесь, что у вас используется <strong>git</strong> версии 1.5 или выше.
</p>

<p>
Если для доступа к <strong>git</strong> вы отдали администратору ключ, специально
созданный для gEDA, вам может быть также нужно добавить к своим настройкам
ещё одну строку, где указать этот дополнительный ключ:
</p>
<pre class="code">Host git.geda-project.org
Port 65
IdentityFile ~/.ssh/gedaproject_dsa</pre>

<p>
Учтите, что файл, на который вы ссылаетесь здесь, это ваш закрытый ключ
(«private key»), а файл, который нужно послать на сервер, это
соответствующий ему открытый ключ («public key»).
</p>

</div>

<h2 id="созданиеивнесениеизменений">Создание и внесение изменений</h2>
<div class="level2">

</div>

<h3 id="настройкаинформацииопользователе">Настройка информации о пользователе</h3>
<div class="level3">

<p>
Сначала вам нужно обеспечить, чтобы в файле настроек <strong>git</strong> у вас были
заданы ваше имя и ваш адрес электронной почты.
</p>
<pre class="code">$ git config --global user.name &quot;Здесь должно быть ваше имя&quot;
$ git config --global user.email вы@ваш_домен.example.com</pre>

</div>

<h3 id="внесениезаплатдругихучастниковпроекта">Внесение заплат других участников проекта</h3>
<div class="level3">

<p>
При наложении чужой заплаты (например, из записи о заплате в <code>launchpad</code>),
следует иметь в виду некоторые моменты. Для вносимых изменений <strong>git</strong>
сохраняет по два имени и по два адреса электронной почты: «автора» заплаты
(«author») и «вносящего» заплату («committer»), и при внесении изменений эти
данные должны быть правильными.
</p>

<p>
Прежде всего, убедитесь, что:
</p>
<ul>
<li class="level1"><div class="li"> ваша версия заплаты --- последняя;</div>
</li>
<li class="level1"><div class="li"> автор заплаты будет рад, что его заплату внесут в репозиторий (и всё ещё не работает над ней);</div>
</li>
<li class="level1"><div class="li"> вы довольны заплатой и возьмёте на себя ответственность за вносимые изменения.</div>
</li>
</ul>

<p>
Для простоты начать можно с неизменённого дерева самой последней версии
(<strong><code>git status</code></strong> не должен показывать никаких изменений).
</p>

<p>
Заплата накладывается обычным способом (как этом в примере):
</p>
<pre class="code">$ patch -p1 &lt; example_changes.patch</pre>

<p>
Можно также использовать команду <strong><code>git apply</code></strong>:
</p>
<pre class="code">$ git apply example_changes.patch</pre>

<p>
Если перед внесением в репозиторий заплату нужно чуть подкорректировать
(например, поправить пробелы), проинформируйте об этом автора. Может быть на
основе этой заплаты он делает что-то другое, и тогда он должен знать, какие
изменения появились в наложенной версии.
</p>

<p>
Примечание: <em>очень легко допустить случайную ошибку, если ваш редактор
заменяет пробелы знаками табуляции. Не разрешайте ему этого!</em>
</p>

<p>
Прежде чем вносить изменения, <strong>git</strong> нужно проинформировать о всех
изменённых, добавленных или, наоборот, удалённых файлах. Чтобы посмотреть,
какие файлы изменены, можно запустить:
</p>
<pre class="code">$ git status</pre>

<p>
Для скорости, командой
</p>
<pre class="code">$ git add -u</pre>

<p>
можно обновить все файлы, отслеживаемые <strong>git</strong>, включая удалённые.
</p>

<p>
Добавление новых файлов, вводимых в репозиторий с этой заплатой,
производится командой
</p>
<pre class="code">$ git add new_file.c</pre>

<p>
Примечание: параметры <strong><code>git add</code></strong> могут также задаваться и с помощью
метасимволов.
</p>

<p>
При внесении заплаты обязательно следует указать имя и адрес электронной
почты автора:
</p>
<pre class="code">$ git commit --author &quot;Здесь должно быть имя автора &lt;author@example.com&gt;&quot;</pre>

<p>
Как вариант, если заранее настроить переменные окружения <code>GIT_AUTHOR_NAME</code>
и <code>GIT_AUTHOR_EMAIL</code>, команду <strong><code>git commit</code></strong> можно запускать как
обычно.
</p>

</div>

<h3 id="написаниехорошихсообщенийовносимыхизменениях">Написание хороших сообщений о вносимых изменениях</h3>
<div class="level3">

<p>
Формат сообщения о вносимых изменениях [&quot;commit message&quot;] следующий:
<strong>строго</strong> однострочное изложение сути заплаты, за которым следует пустая
строка, а затем длинное описание. Если можно уместить полное описание
заплаты в одной строке, --- прекрасно, --- тогда и не стоит забивать голову
насчёт длинного описания.
</p>

<p>
Однострочные описания используются для создания темы электронного письма и
для отображения в журналах <strong>gitk</strong> и <strong>gitweb</strong>. Очень удобно, когда они
написаны хорошо, потому что это значит, что пользователь этих программ
сможет быстро находить интересные изменения.
</p>

<p>
<strong>Не добавляйте</strong> в сообщения о вносимых изменениях перечни изменённых файлов.  Эту информацию очень просто извлечь с помощью инструментария <strong>git</strong>.
</p>

<p>
Пример:
</p>
<pre class="code">Added new GedaList class derived from GObject

This abstracts a GList with API for write access. Its main use is in list
change notification, as it emits a &quot;changed&quot; g_signal when modified.  Read
only access to the underlying GList is provided by an accessor, currenly
implemented as a macro.  </pre>

</div>

<h3 id="операцияpush-разрушительна">Операция push - разрушительна</h3>
<div class="level3">

<p>
<strong>Предупреждение: добавление изменений с помощью <em>push</em> в удалённый репозиторий разрушительно</strong>
</p>

<p>
В отличие от CVS, командой <strong><code>git-push</code></strong> изменения не просто добавляются
в основной репозиторий, но «продвигается» локальная версия. Всегда нужно
дважды (или даже трижды) проверить, что «продвигаемые» вами изменения в
самом деле предназначены для основного репозитория.
</p>

</div>

<h2 id="какмне">Как мне ... ?</h2>
<div class="level2">

<p>
Более подробную информацию можно найти в
Руководстве по Git.
</p>

</div>

<h3 id="получитькопиюрепозиторияgitпроектаgedagaf">... получить копию репозитория git проекта gEDA/gaf?</h3>
<div class="level3">

<p>
При анонимном доступе только на чтение:
</p>
<pre class="code">$ git clone git://git.geda-project.org/geda-gaf</pre>

<p>
Для разработчиков с доступом на чтение и запись:
</p>
<pre class="code">$ git clone ssh://git@git.geda-project.org/geda-gaf</pre>

</div>

<h3 id="поддерживатьсоответствиесвоейлокальнойкопиитекущейверсии">... поддерживать соответствие своей локальной копии текущей версии?</h3>
<div class="level3">

<p>
Те, кто не собирается отправлять свои изменения в центральный репозиторий
<strong>git</strong>, могут запустить:
</p>
<pre class="code">$ git pull</pre>

<p>
Однако тем из вас, кто собирается «продвигать» свои изменения в центральный
репозиторий <strong>git</strong>, использование <strong><code>git pull</code></strong> испортит историю
сообщениями об объединении веток («Merge branch &#039;master&#039;»). Чтобы избежать
этого, нужно запустить:
</p>
<pre class="code">$ git fetch
$ git rebase origin</pre>

</div>

<h3 id="внестисвоиизменениявлокальныйрепозиторийgit">... внести свои изменения в локальный репозиторий git?</h3>
<div class="level3">
<pre class="code">$ git commit -a</pre>

<p>
Эта команда найдёт все изменённые файлы, о которых знает <strong>git</strong>
(добавленные с помощью <strong><code>git-add</code></strong>) и запросит у вас сообщение о
вносимых изменениях.  Непременно следуйте указанному выше соглашению по
написанию таких сообщений, если планируете отправлять свои изменения в
центральный репозиторий.
</p>

<p>
Если вы хотите внести файлы из текущего каталога, или хотите внести только
явно определённые файлы, не указывайте флаг <code>-a</code> и (или) укажите имена
выбранных файлов в командной строке, например:
</p>
<pre class="code">$ git commit filename1 filename2</pre>

</div>

<h3 id="отменитьвселокальныеизмененияещёневнесённыеврепозиторий">... отменить все локальные изменения, ещё не внесённые в репозиторий?</h3>
<div class="level3">
<pre class="code">$ git checkout -f</pre>

<p>
Учтите, что при этом все изменения в любых файлах, отслеживаемых в
<strong>git</strong>-репозитории, будут отвергнуты.
</p>

<p>
Если нужно отменить изменения только в одном файле, достаточно запустить:
</p>
<pre class="code">$ git checkout путь/к/нужному/файлу</pre>

<p>
Если нужно отменить все изменения в текущем каталоге и рекурсивно во всех
его подкаталогах, достаточно запустить:
</p>
<pre class="code">$ git checkout .</pre>

</div>

<h3 id="исправитьотредактироватьизменениявнесённыепоследнийраз">... исправить/отредактировать изменения, внесённые последний раз?</h3>
<div class="level3">
<pre class="code">$ ... изменение каких-то файлов ...
$ git commit --amend filename1..filenameN</pre>

<p>
Этой командой все новые изменения объединяются с внесёнными в последний раз
и заново вносятся в репозиторий со старым сообщением.
</p>

</div>

<h3 id="отслеживатьветку">... отслеживать ветку?</h3>
<div class="level3">
<pre class="code">$ git checkout --track -b &lt;локальная_ветка&gt; origin/&lt;удалённая_ветка&gt;</pre>

<p>
Этой командой создаётся ветка <em>&lt;локальная_ветка&gt;</em>, в которой отслеживается
удалённая ветка <em>&lt;удалённая_ветка&gt;</em>.
</p>

</div>

<h3 id="создатьветкуначинаясопределённоготега">... создать ветку (начиная с определённого тега)?</h3>
<div class="level3">

<p>
Нужно запустить следующие команды (для примера используется ветка
<em>stable-1.4</em>):
</p>
<pre class="code"> $ git branch stable-1.4 1.4.0-20080127
 $ git checkout stable-1.4
 &lt;что-то редактируем&gt;
 $ git commit -a</pre>

<p>
Чтобы опубликовать эту ветку в центральном репозитории (требуется доступ в
него на запись):
</p>
<pre class="code"> $ git push origin stable-1.4</pre>

</div>

<h3 id="получитьветкуразработкидругогоразработчика">... получить ветку разработки другого разработчика?</h3>
<div class="level3">

<p>
Кроме репозитория http://git.geda-project.org/, у нас есть его зеркало
на http://repo.or.cz/w/geda-gaf.git. Некоторые разработчики имеют свои
ответвления («fork») данного репозитория с ветками («branch») разработки
новых возможностей.
</p>

<p>
Если вы хотите попробовать одну из веток с новыми возможностями, нужно
получить её из репозитория разработчика. Самый лёгкий способ получения ветки
--- использовать команду <strong><code>git fetch</code></strong>.
</p>
<pre class="code">  $ git fetch ссылка_на_репозиторий название_удалённой_ветки:название_локальной_ветки</pre>

<p>
<strong>Примеры:</strong>
Получение ветки <em>cairo_experiment</em> от <em>Peter C.</em> выглядело бы так:
</p>
<pre class="code">  $ git fetch git://repo.or.cz/geda-gaf/pcjc2.git cairo_experiment:peters_cairo_experiment</pre>

<p>
Теперь вы можете переключиться на локальную копию ветки
<em>peters_cairo_experiment</em> и поиграться с ней.
</p>

<p>
Более того, в локальный репозиторий можно добавить несколько удалённых ответвлений:
</p>
<pre class="code">  $ git remote add &lt;название&gt; &lt;url&gt;
  $ git fetch &lt;название&gt;</pre>

<p>
При условии, что &lt;название&gt; уникально, у вас появится возможность следить за
их развитием, не создавая локальных веток. С помощью таких
программ, как <strong>gitk</strong>, можно следить за прогрессом в ветках разработки различных возможностей в разных ответвлениях:
</p>
<pre class="code">  $ gitk --all</pre>

<p>
<strong>Примеры:</strong>
</p>
<pre class="code">  $ git remote add peter-b https://github.com/peter-b/geda-gaf.git
  $ git fetch peter-b
  $ git remote add gareth8118 https://github.com/gareth8118/geda-gaf.git
  $ git fetch gareth8118
  $ git remote add bert https://github.com/bert/geda-gaf.git
  $ git fetch bert
  $ gitk --all</pre>

<p>
Теперь gitk будет забит до отказа, но с помощью <strong><em>Файл</em></strong> -&gt; <strong><em>Список
ссылок</em></strong> [<strong><em>File</em></strong> -&gt; <strong><em>List references</em></strong>] (<kbd>F2</kbd>) можно
открыть диалоговое окно для более лёгкой навигации.
</p>

<p>
Обновление любимых веток сократится тогда до:
</p>
<pre class="code">  $ git fetch --all</pre>

</div>

<h3 id="сделатьзаплатучтобыотправитьеёразработчикам">... сделать заплату, чтобы отправить её разработчикам?</h3>
<div class="level3">

<p>
Самый простой способ, в котором в заплату включаются все изменения с тех пор, как локальный репозиторий синхронизировался с репозиторием на geda-project.org:
</p>
<pre class="code">$ git diff &gt; имя_файла_заплаты</pre>

<p>
Более сложный способ с бóльшим контролем над содержимым заплаты:
</p>
<pre class="code">$ git add -i           # выбрать файлы для внесения изменений
$ git status           # проверить, что будут внесены именно те изменения,
                       # которые вы намеревались внести
$ git commit           # внести изменения
$ git format-patch -1  # сделать файл заплаты, основанный на данных изменениях</pre>

<p>
Последняя команда выведет имя файла, содержащего заплату. Чтобы больше узнать об этой команде, обязательно взгляните на документацию по <strong>git-format-patch</strong>. Полученный файл можно отправить по электронной почте разработчикам, имеющим доступ на запись, и они смогут наложить заплату с помощью <strong><code>git apply</code></strong>.
</p>

</div>

<h3 id="восстановитьнасамомделеиспорченныйлокальныйрепозиторий">... восстановить на самом деле испорченный локальный репозиторий?</h3>
<div class="level3">

<p>
Прежде всего, не вздумайте никуда «продвигать» командой <strong><code>git push</code></strong>
никаких изменений из локального репозитория, если вы думаете, что в нём
что-то испорчено. Спросите сначала кого-нибудь более опытного в <strong>git</strong>.
</p>

<p>
Во-вторых, команда, которая в самом деле спасёт вашу шкуру --- это
<strong>git-reflog</strong>. Она используется примерно так:
</p>
<pre class="code"> $ git reflog
 086908e... HEAD@{0}: cherry-pick: Last minute updates to the READMEs for all pro
 2a79a23... HEAD@{1}: checkout: moving to master
 2a79a23... HEAD@{2}: checkout: moving to master
 ...
 $ git reset --hard HEAD@{1}</pre>

<p>
Последняя команда (<strong><code>git reset --hard ...</code></strong>) откатит все ваши
изменения к шагу «checkout: moving to master».  Помните: не паникуйте! С
помощью <strong>git</strong> можно многое починить.
</p>

</div>
</body>
</html>
